<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>A Pen by Ivan</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.1.2/tailwind.min.css"
    />
    <style>
      * {
        /*font-family: 'Rubik', sans-serif;*/
        color: #333333;
        font-size: 17px;
        font-family: Comic Sans MS;
      }
      button,
      .button {
        color: #000;
        border: 2px solid #b4b4b4;
        padding: 0.5rem 2rem;
        margin: 0rem 0.75rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      button[disabled] {
        color: #aaa;
        border-color: #aaa;
      }
      main {
        padding: 0 10px;
      }
    </style>
  </head>

  <body translate="no">
    <div id="mainApp" class="h-screen">
      <!-- Content Generated by JS -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script id="rendered-js" type="text/babel">
      const iconCross = (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="100%"
          /*width="30.708"
          height="30.708"*/
          viewBox="0 0 30.708 30.708"
        >
          <path
            id="Icon_material-close"
            data-name="Icon material-close"
            d="M38.208,10.593,35.115,7.5,22.854,19.761,10.593,7.5,7.5,10.593,19.761,22.854,7.5,35.115l3.093,3.093L22.854,25.947,35.115,38.208l3.093-3.093L25.947,22.854Z"
            transform="translate(-7.5 -7.5)"
            fill="#707070"
          />
        </svg>
      );

      const challenges = [
        /*
      {
        // meta
        metadata: {
          type: "multi_choices" | "general_slotted_choices",
          subtype: "definitions" | "abbreviations" | "audio_select",
          id: <string>,
          difficulty: <int from 0 to 100>,
          has_audio: true | false,
          keywords: ["GPU", "graphics", "processing"]
        }

        // question
        prompt: {
          main_text: "What is GPU?",
          sub_text: "",
          audio: {
            URL: "https://..."
          },
        },

        // answer
        choices: [
          {text: "Graphics Processing Unit", japanese: "グラフィックス プロセッシング ユニット"},
          {text: "Global Positioning Union", japanese: "全地球測位連合"},
          {text: "Graphical Package Unit", japanese: "グラフィカル パッケージ ユニット"},
          {text: "Graphics Platform Unit", japanese: "グラフィック プラットフォーム ユニット"}
        ] | [
          {text: "Graphics", japanese: "グラフィックス"},
          {text: "Global", japanese: "全地球"},
          {text: "Graphical", japanese: "グラフィカル"},

          {text: "Processing", japanese: "プロセッシング"},
          {text: "Positioning", japanese: "測位"},
          {text: "Package", japanese: "パッケージ"},
          {text: "Platform", japanese: "プラットフォーム"},

          {text: "Unit", japanese: "ユニット"},
          {text: "Union", japanese: "連合"},
        ],
        correctSolutions: ["Graphics Processing Unit"],
        correctTokens: ["Graphics", "Processing", "Unit"],
      },
      */

        {
          // meta
          metadata: {
            type: "multi_choices",
            subtype: "listening",
            id: "0",
            has_audio: true,
            keywords: ["system"]
          },
          // question
          prompt: {
            main_text: "Please select the correct option",
            audio: {
              URL: "https://..."
            }
          },
          // answer
          choices: [
            { text: "sisdem" },
            { text: "sistem" },
            { text: "system" },
            { text: "sysdem" }
          ],
          correctTokensList: [["system"]]
        },

        {
          // meta
          metadata: {
            type: "multi_choices",
            subtype: "listening",
            id: "0",
            has_audio: true,
            keywords: ["system"]
          },
          // question
          prompt: {
            main_text: "Please select the correct option",
            audio: {
              URL: "https://..."
            }
          },
          // answer
          choices: [
            { text: "sisdem" },
            { text: "sistem" },
            { text: "system" },
            { text: "sysdem" }
          ],
          correctTokensList: [["system"]]
        }
      ];

      // state
      const NOT_ANSWERED_YET = -1;
      const ANSWER_INCORRECT = 0;
      const ANSWER_CORRECT = 1;

      const Challenge = React.forwardRef((props, ref) => {
        const challenge = props.challenge;
        const [answer, setAnswer] = React.useState([]);
        const [showHint, setShowHint] = React.useState(false);
        const [disabledChoice, setDisabledChoice] = React.useState([]);

        const [answerState, setAnswerState] = React.useState(NOT_ANSWERED_YET);

        // format: {choiceIndex: <int>, text: <string>}

        // challenge.metadata.type;
        // challenge.metadata.subtype;

        function removeFromAnswer(item, i) {
          setDisabledChoice((disabledChoice) =>
            disabledChoice.filter((index) => index !== item.choiceIndex)
          );
          setAnswer((answer) => answer.filter((item_) => item_ !== item));
          setAnswerState(NOT_ANSWERED_YET);
        }

        function pushToAnswer(choice, i) {
          setAnswer([
            ...answer,
            { choiceIndex: i, text: choice.text, japanese: choice.japanese }
          ]);
          setDisabledChoice((disabledChoice) => [...disabledChoice, i]);
          setAnswerState(NOT_ANSWERED_YET);
        }

        function checkAnswer() {
          // multiple answers
          for (let j = 0; j < challenge.correctTokensList.length; j++) {
            const correctTokens = challenge.correctTokensList[j];
            // length match
            if (correctTokens.length !== answer.length) continue;

            // deep match
            let matchFlag = true;
            for (let i = 0; i < answer.length; i++)
              if (correctTokens[i] !== answer[i].text) {
                matchFlag = false;
                break;
              }
            if (matchFlag === false) continue;

            return true;
          }
          return false;
        }

        React.useImperativeHandle(ref, () => ({
          // answerable: () => {
          //   return answer.length > 0;
          // },
          answer: () => {
            const state = checkAnswer() ? ANSWER_CORRECT : ANSWER_INCORRECT;
            setAnswerState(state);
            return state;
          },
          clear: () => {
            answer.forEach(removeFromAnswer);
          }
        }));

        return (
          <div>
            <h2>{challenge.prompt.main_text}</h2>
            <div>{challenge.prompt.sub_text}</div>
            <div style={{ border: "2px solid #aaa" }}>
              <div>
                Answer:{" "}
                {answer.map((item, i) => (
                  <button onClick={(e) => removeFromAnswer(item, i)}>
                    {showHint ? item.japanese : item.text}
                  </button>
                ))}
              </div>
              <div>
                {answerState === ANSWER_INCORRECT
                  ? "Wrong Answer. "
                  : answerState === ANSWER_CORRECT
                  ? "Correct Answer."
                  : ""}
              </div>
            </div>
            <div style={{ marginTop: 10, marginBottom: 10 }}>
              {challenge.choices.map((choice, i) => (
                <button
                  disabled={disabledChoice.includes(i)}
                  onClick={(e) => pushToAnswer(choice, i)}
                  style={{ margin: 10 }}
                >
                  {showHint ? choice.japanese : choice.text}
                </button>
              ))}
            </div>
          </div>
        );
      });

      function Congratulations(props) {
        return (
          <div>
            <h2>Congratulations!</h2>
            <div>You have completed the quiz!</div>
          </div>
        );
      }

      function App() {
        const [pageNum, setPageNum] = React.useState(0);
        const [progress, setProgress] = React.useState(0);
        const [answerState, setAnswerState] = React.useState(NOT_ANSWERED_YET);

        const challengeRef = React.useRef();

        return (
          <div class="flex flex-col h-screen">
            <nav class="flex m-5 p-10 items-center">
              <div class="flex-shrink px-10 h-5"></div>
              <div
                class="flex-grow ml-20"
                style={{
                  height: 20,
                  background: "#F1EEEE",
                  borderRadius: 10
                }}
              >
                <div
                  style={{
                    background: "#7AF16C",
                    height: "100%",
                    width: progress * 100 + "%",
                    borderRadius: 10,
                    transition: ".5s"
                  }}
                />
              </div>
              <div class="flex-shrink px-20 h-5">{iconCross}</div>
            </nav>

            <main class="flex-grow p-10 px-40 lg:px-60 xl:px-80">
              {pageNum < challenges.length ? (
                <Challenge ref={challengeRef} challenge={challenges[pageNum]} />
              ) : (
                <Congratulations />
              )}
            </main>

            {pageNum < challenges.length ? (
              <div class="flex my-20 mx-96 flex-cols align-middle items-center">
                <button onClick={(e) => setShowHint((sh) => !sh)}>Hint</button>
                <div class="flex-grow"></div>
                {answerState === NOT_ANSWERED_YET ? (
                  <button
                    class="block"
                    // disabled={!challengeRef.current.answerable()}
                    onClick={(e) => {
                      const answer_state = challengeRef.current.answer();

                      setAnswerState(answer_state);
                      if (answer_state == ANSWER_CORRECT)
                        setProgress((pageNum + 1) / challenges.length);
                    }}
                  >
                    answer
                  </button>
                ) : (
                  <button
                    class="block"
                    onClick={(e) => {
                      challengeRef.current.clear();

                      // change to next page
                      setAnswerState(NOT_ANSWERED_YET);
                      setProgress((pageNum + 1) / challenges.length);
                      setPageNum((num) => num + 1);
                    }}
                  >
                    {
                      // pageNum + 1 < challenges.length ?
                      "Go to Next"
                      // : "Complete Quiz"
                    }
                  </button>
                )}
              </div>
            ) : null}
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("mainApp"));
    </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>A Pen by Ivan</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.1.2/tailwind.min.css"
    />
    <style>
      * {
        /*font-family: 'Rubik', sans-serif;*/
        color: #333333;
        font-size: 17px;
        font-family: Comic Sans MS;
      }
      button,
      .button {
        color: #000;
        border: 2px solid #b4b4b4;
        padding: 0.5rem 2rem;
        margin: 0rem 0.75rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      button[disabled] {
        color: #aaa;
        border-color: #aaa;
      }
      main {
        padding: 0 10px;
      }
    </style>
  </head>

  <body translate="no">
    <div id="mainApp" class="h-screen">
      <!-- Content Generated by JS -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script id="rendered-js" type="text/babel">
      const iconCross = (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="100%"
          /*width="30.708"
          height="30.708"*/
          viewBox="0 0 30.708 30.708"
        >
          <path
            id="Icon_material-close"
            data-name="Icon material-close"
            d="M38.208,10.593,35.115,7.5,22.854,19.761,10.593,7.5,7.5,10.593,19.761,22.854,7.5,35.115l3.093,3.093L22.854,25.947,35.115,38.208l3.093-3.093L25.947,22.854Z"
            transform="translate(-7.5 -7.5)"
            fill="#707070"
          />
        </svg>
      );

      const challenges = [
        /*
      {
        // meta
        metadata: {
          type: "multi_choices" | "general_slotted_choices",
          subtype: "definitions" | "abbreviations" | "audio_select",
          id: <string>,
          difficulty: <int from 0 to 100>,
          has_audio: true | false,
          keywords: ["GPU", "graphics", "processing"]
        }

        // question
        prompt: {
          main_text: "What is GPU?",
          sub_text: "",
          audio: {
            URL: "https://..."
          },
        },

        // answer
        choices: [
          {text: "Graphics Processing Unit", japanese: "グラフィックス プロセッシング ユニット"},
          {text: "Global Positioning Union", japanese: "全地球測位連合"},
          {text: "Graphical Package Unit", japanese: "グラフィカル パッケージ ユニット"},
          {text: "Graphics Platform Unit", japanese: "グラフィック プラットフォーム ユニット"}
        ] | [
          {text: "Graphics", japanese: "グラフィックス"},
          {text: "Global", japanese: "全地球"},
          {text: "Graphical", japanese: "グラフィカル"},

          {text: "Processing", japanese: "プロセッシング"},
          {text: "Positioning", japanese: "測位"},
          {text: "Package", japanese: "パッケージ"},
          {text: "Platform", japanese: "プラットフォーム"},

          {text: "Unit", japanese: "ユニット"},
          {text: "Union", japanese: "連合"},
        ],
        correctSolutions: ["Graphics Processing Unit"],
        correctTokens: ["Graphics", "Processing", "Unit"],
      },
      */

        {
          // meta
          metadata: {
            type: "multi_choices",
            subtype: "listening",
            id: "0",
            has_audio: true,
            keywords: ["system"]
          },
          // question
          prompt: {
            main_text: "Please select the correct option",
            audio: {
              URL: "https://..."
            }
          },
          // answer
          choices: [
            { text: "sisdem" },
            { text: "sistem" },
            { text: "system" },
            { text: "sysdem" }
          ],
          correctTokensList: [["system"]]
        },

        {
          // meta
          metadata: {
            type: "multi_choices",
            subtype: "listening",
            id: "0",
            has_audio: true,
            keywords: ["system"]
          },
          // question
          prompt: {
            main_text: "Please select the correct option",
            audio: {
              URL: "https://..."
            }
          },
          // answer
          choices: [
            { text: "sisdem" },
            { text: "sistem" },
            { text: "system" },
            { text: "sysdem" }
          ],
          correctTokensList: [["system"]]
        }
      ];

      // state
      const NOT_ANSWERED_YET = -1;
      const ANSWER_INCORRECT = 0;
      const ANSWER_CORRECT = 1;

      const Challenge = React.forwardRef((props, ref) => {
        const challenge = props.challenge;
        const [answer, setAnswer] = React.useState([]);
        const [showHint, setShowHint] = React.useState(false);
        const [disabledChoice, setDisabledChoice] = React.useState([]);

        const [answerState, setAnswerState] = React.useState(NOT_ANSWERED_YET);

        // format: {choiceIndex: <int>, text: <string>}

        // challenge.metadata.type;
        // challenge.metadata.subtype;

        function removeFromAnswer(item, i) {
          setDisabledChoice((disabledChoice) =>
            disabledChoice.filter((index) => index !== item.choiceIndex)
          );
          setAnswer((answer) => answer.filter((item_) => item_ !== item));
          setAnswerState(NOT_ANSWERED_YET);
        }

        function pushToAnswer(choice, i) {
          setAnswer([
            ...answer,
            { choiceIndex: i, text: choice.text, japanese: choice.japanese }
          ]);
          setDisabledChoice((disabledChoice) => [...disabledChoice, i]);
          setAnswerState(NOT_ANSWERED_YET);
        }

        function checkAnswer() {
          // multiple answers
          for (let j = 0; j < challenge.correctTokensList.length; j++) {
            const correctTokens = challenge.correctTokensList[j];
            // length match
            if (correctTokens.length !== answer.length) continue;

            // deep match
            let matchFlag = true;
            for (let i = 0; i < answer.length; i++)
              if (correctTokens[i] !== answer[i].text) {
                matchFlag = false;
                break;
              }
            if (matchFlag === false) continue;

            return true;
          }
          return false;
        }

        React.useImperativeHandle(ref, () => ({
          // answerable: () => {
          //   return answer.length > 0;
          // },
          answer: () => {
            const state = checkAnswer() ? ANSWER_CORRECT : ANSWER_INCORRECT;
            setAnswerState(state);
            return state;
          },
          clear: () => {
            answer.forEach(removeFromAnswer);
          }
        }));

        return (
          <div>
            <h2>{challenge.prompt.main_text}</h2>
            <div>{challenge.prompt.sub_text}</div>
            <div style={{ border: "2px solid #aaa" }}>
              <div>
                Answer:{" "}
                {answer.map((item, i) => (
                  <button onClick={(e) => removeFromAnswer(item, i)}>
                    {showHint ? item.japanese : item.text}
                  </button>
                ))}
              </div>
              <div>
                {answerState === ANSWER_INCORRECT
                  ? "Wrong Answer. "
                  : answerState === ANSWER_CORRECT
                  ? "Correct Answer."
                  : ""}
              </div>
            </div>
            <div style={{ marginTop: 10, marginBottom: 10 }}>
              {challenge.choices.map((choice, i) => (
                <button
                  disabled={disabledChoice.includes(i)}
                  onClick={(e) => pushToAnswer(choice, i)}
                  style={{ margin: 10 }}
                >
                  {showHint ? choice.japanese : choice.text}
                </button>
              ))}
            </div>
          </div>
        );
      });

      function Congratulations(props) {
        return (
          <div>
            <h2>Congratulations!</h2>
            <div>You have completed the quiz!</div>
          </div>
        );
      }

      function App() {
        const [pageNum, setPageNum] = React.useState(0);
        const [progress, setProgress] = React.useState(0);
        const [answerState, setAnswerState] = React.useState(NOT_ANSWERED_YET);

        const challengeRef = React.useRef();

        return (
          <div class="flex flex-col h-screen">
            <nav class="flex m-5 p-10 items-center">
              <div class="flex-shrink px-10 h-5"></div>
              <div
                class="flex-grow ml-20"
                style={{
                  height: 20,
                  background: "#F1EEEE",
                  borderRadius: 10
                }}
              >
                <div
                  style={{
                    background: "#7AF16C",
                    height: "100%",
                    width: progress * 100 + "%",
                    borderRadius: 10,
                    transition: ".5s"
                  }}
                />
              </div>
              <div class="flex-shrink px-20 h-5">{iconCross}</div>
            </nav>

            <main class="flex-grow p-10 px-40 lg:px-60 xl:px-80">
              {pageNum < challenges.length ? (
                <Challenge ref={challengeRef} challenge={challenges[pageNum]} />
              ) : (
                <Congratulations />
              )}
            </main>

            {pageNum < challenges.length ? (
              <div class="flex my-20 mx-96 flex-cols align-middle items-center">
                <button onClick={(e) => setShowHint((sh) => !sh)}>Hint</button>
                <div class="flex-grow"></div>
                {answerState === NOT_ANSWERED_YET ? (
                  <button
                    class="block"
                    // disabled={!challengeRef.current.answerable()}
                    onClick={(e) => {
                      const answer_state = challengeRef.current.answer();

                      setAnswerState(answer_state);
                      if (answer_state == ANSWER_CORRECT)
                        setProgress((pageNum + 1) / challenges.length);
                    }}
                  >
                    answer
                  </button>
                ) : (
                  <button
                    class="block"
                    onClick={(e) => {
                      challengeRef.current.clear();

                      // change to next page
                      setAnswerState(NOT_ANSWERED_YET);
                      setProgress((pageNum + 1) / challenges.length);
                      setPageNum((num) => num + 1);
                    }}
                  >
                    {
                      // pageNum + 1 < challenges.length ?
                      "Go to Next"
                      // : "Complete Quiz"
                    }
                  </button>
                )}
              </div>
            ) : (
              <div class="flex my-20 mx-96 flex-cols align-middle items-center">
                <div class="flex-grow"></div>
                <button onClick={(e) => {}}>Back to Home</button>
              </div>
            )}
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("mainApp"));
    </script>
  </body>
</html>
