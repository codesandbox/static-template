<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>abort.html</title>
</head>
<body>


<script>

  async function abort() {
// 1 秒后中止
    let controller = new AbortController();
    setTimeout(() => controller.abort(), 1000);

    try {
      let response = await fetch('/article/fetch-abort/demo/hang', {
        signal: controller.signal
      });
    } catch(err) {
      if (err.name === 'AbortError') { // handle abort()
        alert("Aborted!");
      } else {
        throw err;
      }
    }

  }

  abort();

  let data = [];
  let urls = [...data];
  let controller = new AbortController();

  let ourJob = new Promise((resolve, reject) => { // 我们的任务
  ...
    controller.signal.addEventListener('abort', reject);
  });

  let fetchJobs = urls.map(url => fetch(url, { // fetches
    signal: controller.signal
  }));

  // 等待完成我们的任务和所有 fetch
  let results = await Promise.all([...fetchJobs, ourJob]);

  // 如果 controller.abort() 被从其他地方调用，
  // 它将中止所有 fetch 和 ourJob


</script>

</body>
</html>
